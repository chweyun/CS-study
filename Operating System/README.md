# Computer Structure

## CH.1 | Overview

### 💡 OS의 역할

- 운영체제 : 컴퓨터의 하드웨어 관리. 하드웨어-소프트웨어-사용자를 매개하는 프로그램. 커널과 커널 모듈들로 구성.
- 커널 : 운영체제의 핵심. 운영체제와 동일시됨 (커널이 같다면 같은 운영체제로 취급)


### 💡 Computer-System Organization

#### Computer-System Operation
- 일반적인 컴퓨터 시스템은 여러 개의 CPU + 장치 컨트롤러로 구성. 이들은 공통 버스로 이어져 메모리를 공유한다.
- 인터럽트(Interrupt) : 장치 컨트롤러가 CPU에게 이벤트 발생을 알리는 것
- 보통 컴퓨터는 여러 작업을 동시에 처리하는데, 이때 당장 처리해야 하는 일이 생겨서 기존의 작업을 잠시 중단해야 하는 경우 인터럽트 신호를 보냄. 그러면 커널은 작업을 멈추고 인터럽트를 처리한 뒤 다시 기존 작업으로 돌아옴.
- 하드웨어의 경우 시스템 버스(System bus)를 통해 CPU에 신호를 보냄으로써 인터럽트를 발생
- 소프트웨어의 경우 시스템 콜(System call)이라는 특별한 명령으로 인터럽트를 발생

#### Common Functions of Interrupts
보통 컴퓨터는 여러 작업을 동시에 처리하는데, 만약 CPU가 인터럽트 신호를 받으면, 앞서 말했듯이 하던 일을 잠시 멈추고 메모리의 어떤 고정된 위치(Fixed location)를 찾는다. 이 위치는 인터럽트 벡터(Interrupt vector)에 저장되어 있다.
- 인터럽트 벡터 : 인터럽트를 처리할 수 있는 서비스 루틴(Service routine)들의 주소를 가지고 있는 공간. 파일 읽기/쓰기와 같은 중요한 동작들이 하드코딩되어 있다.

#### Interrupt Handling
현대 운영체제들은 대부분 인터럽트 주도적
- 인터럽트가 발생하기 전까지 CPU는 대기상태. 반면 폴링(Polling, 상태를 주기적으로 체크하는 방식)의 경우 주기적으로 이벤트를 감시해 처리 루틴을 실행.
- 이는 컴퓨팅 자원 낭비이기 때문에 인터럽트 주도적으로 설계하는 것.


### 💡 Storage Structure
- 휘발성 기억장치 : 용량이 작고 비쌈. 전원이 나가면 저장된 데이터가 모두 사라짐.
    - 메인 메모리, 캐시(Cache), 레지스터(Registers)
- 비휘발성 기억장치 : 용량이 크고 저렴함. 보조기억장치로 사용.
    - 자기테이프(Magnetic tapes), 광학디스크(Optical disk), 자기디스크(Magnetic disk), SSD(Soli-State Disk)


### 💡 I/O Structure
- 컴퓨터는 다양한 입출력 장치를 가지고 있으며, 입출력 컨트롤러는 각각 다른 장치를 담당.
- 운영체제는 각 장치 컨트롤러를 제어하기 위한 장치 드라이버(Device driver)를 가지고 있다.
- 시스템 콜(System call) : 커널과 사용자 프로그램을 매개하는 인터페이스

1. 입출력 명령
2. 장치 드라이버는 장치 컨트롤러의 레지스터를 로드
3. 장치 컨트롤러는 레지스터에서 "키보드로부터 문자 읽어오기"와 같은 동작을 읽고, 장치에서 로컬 버퍼(Local buffer)로 데이터를 전송하기 시작
4. 데이터의 전송이 끝나면 장치 컨트롤러는 장치 드라이버에게 인터럽트를 보내 동작이 끝났음을 알림
5. 장치 드라이버는 통제권을 운영체제에게 돌려줌


### 💡 Direct Memory Access Structure
- 과거에는 장치 데이터를 처리하기 위해 CPU를 거쳐 메모리에 로드하는 방식을 사용 -> CPU 자원을 너무 많이 소모
- 현재는 DMA(Direct Memory Access)를 사용

DMA(Direct Memory Access) : 장치와 메모리를 직접 연결하는 방식으로, 버스가 지원하는 기능


### 💡 Operating System Structure
- 멀티프로그래밍 : 여러 프로그램을 메모리에 로드해 두고 한 프로세스가 대기 상태가 되면 다른 프로세스의 작업을 수행하는 시스템.
    - CPU 사용 효율 증가.
- 시분할 시스템 : (= 멀티태스킹) 프로세스마다 작업 시간을 정해두고 번갈아가면서 작업하는 방식.


- 만약 메모리를 너무 많이 사용하게 되는 경우, 반응 시간을 줄이기 위해 가상 메모리(Virtual memory)를 사용
- 가상 메모리 : 보조기억장치의 일부를 메인 메모리처럼 사용하는 기술


### 💡 Dual-Mode and Multimode Operation
- 운영체제는 사용자 프로그램이 함부로 시스템에 접근하지 못하도록 모드(Mode)를 나눠둠.
    - 유저 모드, 커널 모드
- 이러한 이중 모드(Dual-mode) 방식을 사용하면 나쁜 의도를 가진 사용자로부터 운영체제, 하드웨어를 비롯한 시스템과 사용자를 보호할 수 있음
    - 하드웨어는 커널 모드일 때만 특권 명령(Privileged instructions)을 실행
    - 만약 유저 모드에서 특권 명령을 실행하려 한다면 하드웨어는 이 동작을 막고 운영체제에게 트랩을 보냄


### 💡 Timer
- 운영체제는 사용자의 프로그램이 제어권을 운영체제에게 넘겨주지 않는 상황을 방지하기 위해 타이머(Timer)를 사용
- 타이머는 운영체제에게 제어권을 보장하기 위해 특정 주기에 인터럽트를 발생


### 💡 Process Management
- 디스크에 있으면 프로그램, 메모리에 로드되면 프로세스
    - 프로그램은 디스크에 저장되어 있는 수동적(Passive) 존재인 반면 프로세스는 능동적(Active) 존재
    - 프로세스는 프로그램이 어디까지 실행되었는지 북마크하는 프로그램 카운터(Program counter)를 가지고 있음.
        - 싱글쓰레드(Single-thread) 프로세스는 하나의 프로그램 카운터를 가지고 있음
        - 멀티쓰레드(Multi-threads) 프로세스는 여러개의 프로그램 카운터를 가지고 있음


### 💡 Storage Management
1. File-System Management
- 운영체제는 파일을 생성, 제거하며, 당연히 읽기, 쓰기도 한다.

2. Mass-Storage Management


3. Caching
- 캐시 : 굉장히 빠르고 작은 저장장치
- 캐싱 : 캐시 메모리를 사용해 컴퓨터의 속도를 높이는 기술. 지역성(Locality) 원리를 사용.
    - 시간지역성 : 한 번 접근한 데이터에 다시 접근할 확률이 높다는 것.
    - 공간지역성 : 특정 데이터와 가까운 메모리 주소에 있는 다른 데이터들에도 접근할 가능성이 높다는 것.


### 💡 Protection and Security
운영체제는 내외부로부터 컴퓨터를 위험하게 만드는 요소를 막기 위해 다양한 활동을 한다.
권한 확대(Privilege escalation) : 컴퓨터 시스템의 권한을 여러 층으로 나누고, 사용자의 권한을 구분해 어떤 행동이나 기준에 따라 사용자의 권한을 상승시키는 시스템.
- 수직 권한 확대 : ex. 임의의 코드를 실행시켜 더 높은 권한을 얻는 행위
- 수평 권한 확대 : ex. 안드로이드 루팅, iOS 탈옥